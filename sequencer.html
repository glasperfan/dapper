<!DOCTYPE html>
<html>
<head>
	<!-- Basic Drum Sequencer. Built by Hugh Zabriskie.	-->
	
	<meta charset="UTF-8">
	
	<!-- CSS -->
	<link rel="stylesheet" type="text/css" href="sequencer.css">
	<link rel="stylesheet" type="text/css" href="pace.css">
	
		
	<!-- JAVASCRIPT -->
	<script src="sequencer.js"></script>
	<script src="base.js"></script>
	<script src="track.js"></script>
	<script src="synth.js"></script>
	<script src="buffer-loader.js"></script>
	<script src="piano.js"></script>
	<script src="generator.js"></script>
	<script src="pace.js"></script>
	<script src="http://documentcloud.github.io/underscore/underscore-min.js"></script>
	
		
</head>
<body>
	<div class="screen" id="console">
		<div class="container">
			<div class="img-wrapper">
				<img src="chevron.png"/>
			</div>
			<input type="text" id="command" name="command" value="add pianocol(as5-1,f5-1.5,d5-2,a5-2.5,f5-3,c5-3.5,g5-4,d5-4.25,c5-4.5,as4-4.75)">
			<div id="message" onclick="hide(this);">Some error occurred.</div>
			<div id="tracks">
				<table style="width:100%" id="tracks-table">
				  	<thead>
					  	<tr>
					    	<th>Index</th>
							<th>Instrument</th>
							<th>Section</th>
					    	<th>Melody</th> 
					    	<th>Rhythm</th>
					 	</tr>
				  	</thead>
				  	<tbody></tbody>
				</table>
			</div>
		</div>
	</div>
	<div class="screen" id="instructions">
		<div class="wrapper">
			<h1>Instructions</h1>
			<p style="text-align:center"><i>(read what's useful, then make some music!)</i></p>
			
			<h4>add</h4>
			<p>To add a track, specify the instrument and then the necessary melodic and rhythmic information. If melodic content is required, 
				it is placed between parentheses next to the instrument name, comma separated
			</p>
			<code>add &lt;instrument&gt;(&lt;notes&gt;) &lt;rhythm&gt;</code>
			<p>For example:</p>
			<code>add snare every 4th offset(0.5)</code>
			<code>add hihat on 1 1.5 2.5 4 4.25 4.5 4.75 gain(0.6)</code>
			<code>add piano(d5,e5,g6,as6) every 16th</code>
			<p>Use the <span class="ic">every</span> token to specify a uniform rhythmic pattern, like every beat, every 8th note, etc.</p>
			<p>Use the <span class="ic">on</span> token to specify a more specific rhythm. 1 means "beat 1", 2.5 means "2 and", etc.</p>
			
			<h4>monosynth</h4>
			<p>The monosynth has a slightly different syntax.</p>
			<code>add monosynth(&lt;notes&gt;) len(...)</code>
			<p><span class="ic">len()</span> denotes the length of each note, measured in fractions of a beat. So 1 = quarter note. For example:</p>
			<code>add monosynth(c3,b2,g3,e3) len(2) gain(0.4)</code>
			
			<p>
				Other tips:
				<ul>
					<li><span class="ic">offset</span> defines the number of beats to offset each note. So <span class="ic">offset(0.25)</span> offsets each note by a sixteenth beat. This is useful for creating arppegios.</li>
					<li>Set the tempo by just running <span class="ic">tempo &lt;value&gt;</span>. Tempo can range from 60 to 240bpm.</li>
					<li>The meter is currently fixed at 4/4. Hoping to make that adjustable soon.</li>
				</ul>
			</p>
			
			<h4>notes</h4>
			<p>Notes are represented in midi format. So <span class="ic">c4</span> = Middle C (the 4th 'C' up on the piano)</p>
			<p>Currently enharmonics are not supported (changing soon...). For now, type 'as' instead of 'bb'. (A-sharp vs. B-flat)</p>
			<p>Multiple notes can be added by simply placing a comma in between them</p>
			<p>Possible notes span almost all of an 88-key piano: c0 to c7</p>
			</p>
			
			<h4>define</h4>
			<p>Define a "section", or a set of tracks, as follows: <span class="ic">define &lt;section&gt;</span></p>
			<p>Define a section, alternatively, via an equation of other sections. For example, <span class="ic">define c=a+b-d</span></p>
			
			<h4>remove instruments</h4>
			<p>
				You can remove instruments in a few ways.
				<ul>
					<li><span class="ic">rm</span> simply removes everything</li>
					<li><span class="ic">rm last</span> removes the last added track</li>
					<li><span class="ic">rm &lt;section&gt;</span> removes all tracks in that section</li>
					<li><span class="ic">rm &lt;instrument&gt;</span> removes all tracks of that type of instrument (piano, hihat, etc.)</li>
				</ul>
			</p>
			<h4>play</h4>
			<p>The basic command is, you guessed it, <span class="ic">play</span>. That begins the loop. But maybe you only want to play a few of the tracks.</p>
			<p>With <span class="ic">play</span>, you can specify an <i>equation</i> that defines the subset of tracks to play. For example:</p>
			<ul>
				<li><span class="ic">play a</span> plays all tracks in section A</li>
				<li><span class="ic">play a+b</span> plays all tracks in sections A and B</li>
				<li><span class="ic">play c-a+d</span> plays all tracks in C that aren't in A, plus the ones in D</li>
				<li><span class="ic">play all-a+a</span> plays all tracks except the ones in A, plus the ones in A...so all tracks. it's an example</li>
			</ul>
			
			<h4>pause and stop</h4>
			<p><span class="ic">pause</span> pauses the sequencer</p>
			<p><span class="ic">stop</span> pauses the sequencer and deletes the tracks</p>
			
			<h4>show/hide</h4>
			<p><span class="ic">show/hide</span> will show/hide all tracks</p>
			<p><span class="ic">show &lt;section&gt;</span> displays tracks for that section</p>
			<p><span class="ic">show/hide instructions</span> will show/hide the instructions page (useful when you have a lot of tracks)</p>
			
			<h4>do you like this??</h4>
			<p>All questions and comments are much appreciated. Political, existential or otherwise.</p>
			<p>Get in touch with me <a href="/#contact">here</a>. I respond quickly.</p>
		</div>
		<div class="footer">
			<span>Copyright &#169; 2015 Hugh Zabriskie. All rights reserved.</span>
		</div>
	</div>
</body>

<script>
	
	// THE TODOs
	// 1. tab completion
	// 3. add "set" functionality
	// 4. Big goal: allow for collaboration and saving of tracks
	
	var command = document.getElementById("command");
	
	function startHere() {
		sequencer = new Sequencer(140, 1);
		HISTORY = [];
		hist_index = 0;
		
		document.onkeydown = respond;
	}
	
	function respond(e) {
		e = e || window.event;
		
		// ENTER
		if (e.keyCode === 13) {
			var c = getCommand();
			setCommand("");
			sequencer.evaluateCommand(c);
			if (c !== "") {
				HISTORY.push(c);
				hist_index = 0;
			}
		}
		
		// (^) UP ARROW
		if (e.keyCode === 38) {
			e.preventDefault();
			var len = HISTORY.length;
			if (len - hist_index > 0) {
				hist_index += 1;
				setCommand(HISTORY[len - hist_index]);
			}
			setCaretAtEnd();
		}
		
		// DOWN ARROW
		if (e.keyCode === 40) {
			e.preventDefault();
			var len = HISTORY.length;
			if (hist_index > 0)
					hist_index -= 1;
			setCommand(
				hist_index > 0 ? HISTORY[len - hist_index] : ""
			);
			setCaretAtEnd();
		}
	}
	
	function getCommand() { return command.value; }
	function setCommand(value) { command.value = value; }
	
	function setCaretAtEnd() { 
		command = document.getElementById("command");
		var endPos = command.value.length;
		command.setSelectionRange(endPos, endPos);
	}
	
	
	// ...and START
	startHere();
	
</script>
</html>